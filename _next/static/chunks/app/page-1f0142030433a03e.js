(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{811:(e,t,n)=>{Promise.resolve().then(n.bind(n,5394))},5394:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>y});var o=n(5155),l=n(2785),a=n(5541);let i=a.sh.createBlockDefinitionsFromJsonArray([{type:"io_read_line",tooltip:"Read Line",helpUrl:"",message0:"read line",output:"String",colour:270},{type:"io_read_number",tooltip:"Read Number",helpUrl:"",message0:"read number",output:"Number",colour:270},{type:"io_puts",tooltip:"Print",helpUrl:"",message0:"puts %1",args0:[{type:"input_value",name:"VALUE"}],previousStatement:null,nextStatement:null,colour:270},{type:"io_read_numbers",tooltip:"Read multiple numbers",helpUrl:"",message0:"read numbers of line",output:"Array",colour:270}]);a.sh.defineBlocks(i);let s=a.sh.createBlockDefinitionsFromJsonArray([{type:"get_index",tooltip:"Get an item from array",helpUrl:"",message0:"%1[%2]",args0:[{type:"input_value",name:"Array"},{type:"input_value",name:"Index"}],output:"String",colour:270},{type:"slice",tooltip:"Get slice from array",helpUrl:"",message0:"%1[%2,%3]",args0:[{type:"input_value",name:"String"},{type:"input_value",name:"Index"},{type:"input_value",name:"Count"}],output:"String",colour:270}]);a.sh.defineBlocks(s);let r=a.sh.createBlockDefinitionsFromJsonArray([]);a.sh.defineBlocks(r);let c=a.sh.createBlockDefinitionsFromJsonArray([{type:"call_method",tooltip:"Call method",helpUrl:"",message0:"%1.%2(%3)",args0:[{type:"input_value",name:"Object"},{type:"field_input",name:"Method",text:""},{type:"input_value",name:"Args"}],output:"Number",colour:270},{type:"times",tooltip:"Repeat a block multiple times",helpUrl:"",message0:"repeat %1 times %2",args0:[{type:"input_value",name:"TIMES"},{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,colour:270}]);a.sh.defineBlocks(c),Object.assign({},i,s,r,c);var u=n(2115),p=n(3603),d=n(5028),m=n(8300),b=n(5695);class _ extends a.jZ{getReservedWords(){return this.RESERVED_WORDS_}getDefinitions(){return this.definitions_||{}}setDefinitions(e){this.definitions_=e}setFunctionNames(e){this.functionNames_=e}resetNameDB(){this.nameDB_&&this.nameDB_.reset()}quote_(e){return'"'.concat(e.replace(/\\/g,"\\\\").replace(/"/g,'\\"'),'"')}}let g=new _("Crystal"),f={ATOMIC:0,FUNCTION_CALL:2,EXPONENTIATION:3,MULTIPLICATIVE:5,ADDITIVE:6,RELATIONAL:11,NONE:99};for(let[e,t]of(g.init=e=>{g.nameDB_=new a.fS("abstract,alias,as,asm,begin,break,case,class,def,do,else,elsif,end,ensure,enum,extend,for,fun,if,include,instance_sizeof,is_a?,lib,macro,module,next,nil,nil?,of,out,pointerof,private,protected,require,rescue,responds_to?,return,select,self,sizeof,struct,super,then,true,false,type,typeof,uninitialized,union,unless,until,when,while,with,yield,__FILE__,__LINE__,Array,Hash,String,Int32,Int64,Float32,Float64,Bool,Symbol,Nil,Proc,Pointer,IO,File,Time,Tuple,and,or,not"),g.nameDB_.setVariableMap(e.getVariableMap()),g.setDefinitions(Object.create(null)),g.setFunctionNames(Object.create(null))},g.finish=e=>{let t=Object.values(g.getDefinitions()||{}).join("\n");return g.resetNameDB(),[t,e].filter(Boolean).join("\n\n")},g.scrub_=(e,t)=>{var n;let o=e.getCommentText(),l=o?g.prefixLines("# ".concat(o),""):"",a=null==(n=e.nextConnection)?void 0:n.targetBlock();return l+t+(a?g.blockToCode(a):"")},Object.entries({io_read_line:()=>["gets.not_nil!.chomp",f.ATOMIC],io_read_number:()=>["gets.not_nil!.to_i64",f.ATOMIC],io_puts:(e,t)=>{let n=t.valueToCode(e,"VALUE",f.NONE)||'""';return"puts ".concat(n)},io_read_numbers:()=>["gets.not_nil!.split.map(&.to_i64)",f.ATOMIC],controls_if:(e,t)=>{let n=t.valueToCode(e,"IF0",f.NONE)||"false",o=t.statementToCode(e,"DO0")||"",l="if ".concat(n,"\n").concat(o),a=1;for(;e.getInput("IF".concat(a));){let n=t.valueToCode(e,"IF".concat(a),f.NONE)||"false",o=t.statementToCode(e,"DO".concat(a))||"";l+="\nelsif ".concat(n,"\n").concat(o),a++}if(e.getInput("ELSE")){let n=t.statementToCode(e,"ELSE");l+="\nelse\n".concat(n)}return l+"\nend\n"},logic_compare:(e,t)=>{let n={EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">="}[e.getFieldValue("OP")],o=t.valueToCode(e,"A",f.RELATIONAL)||"0",l=t.valueToCode(e,"B",f.RELATIONAL)||"0";return["".concat(o," ").concat(n," ").concat(l),f.RELATIONAL]},call_method:(e,t)=>{let n=t.valueToCode(e,"Object",f.ATOMIC)||"nil",o=e.getFieldValue("Method")||"",l=t.valueToCode(e,"Args",f.NONE)||"";return["".concat(n,".").concat(o,"(").concat(l,")"),f.FUNCTION_CALL]},times:(e,t)=>{let n=t.valueToCode(e,"TIMES",f.ATOMIC)||"0",o=t.statementToCode(e,"DO")||"";return"".concat(n,".times do\n").concat(o,"end\n")},math_number:e=>[e.getFieldValue("NUM")||"0",f.ATOMIC],math_arithmetic:(e,t)=>{let n={ADD:["+",f.ADDITIVE],MINUS:["-",f.ADDITIVE],MULTIPLY:["*",f.MULTIPLICATIVE],DIVIDE:["/",f.MULTIPLICATIVE],POWER:["**",f.EXPONENTIATION]}[e.getFieldValue("OP")],o=t.valueToCode(e,"A",n[1])||"0",l=t.valueToCode(e,"B",n[1])||"0";return["".concat(o," ").concat(n[0]," ").concat(l),n[1]]}})))g.forBlock[e]=t;let h=(0,d.default)(()=>n.e(215).then(n.bind(n,9215)),{loadableGenerated:{webpack:()=>[null]},ssr:!1}),y=()=>{let e=(0,b.useSearchParams)(),t=(0,u.useRef)(null),n=e.get("xmlBase64")||"",a=void 0!=n?atob(decodeURIComponent(n)):"{}",{workspace:i,json:s,xml:r}=(0,l.P2)({ref:t,initialXml:a,toolboxConfiguration:'\n<xml>\n  <category name="IO">\n    <block type="io_read_line"/>\n    <block type="io_read_number"/>\n    <block type="io_read_numbers"/>\n    <block type="io_puts"/>\n  </category>\n  <category name="リテラル">\n    <block type="text"/>\n    <block type="math_number"/>\n  </category>\n  <category name="変数/演算">\n    <block type="variables_set"/>\n    <block type="variables_get"/>\n    <block type="math_arithmetic"/>\n    <block type="get_index"/>\n    <block type="slice"/>\n    <block type="call_method"/>\n    <block type="logic_compare"/>\n    <block type="text_join"/>\n  </category>\n  <category name="制御">\n    <block type="controls_if"/>\n    <block type="logic_compare"/>\n    <block type="times"/>\n  </category>\n</xml>\n',workspaceConfiguration:{horizontalLayout:!0,sounds:!1,theme:{...m.BD.Zelos,componentStyles:{...m.BD.Zelos.componentStyles,workspaceBackgroundColour:"#dfd0b8",toolboxBackgroundColour:"#222831"}}}}),[c,d]=(0,u.useState)(!1),[_,f]=(0,u.useState)("");(0,u.useEffect)(()=>{console.log(s,r)},[s,r]);let y=(0,u.useCallback)(()=>{i&&(f(g.workspaceToCode(i)),d(!0))},[i]),x=(0,u.useCallback)(()=>{_&&navigator.clipboard.writeText(_)},[_]);return(0,o.jsxs)("div",{className:"h-dvh flex flex-col",children:[(0,o.jsxs)("header",{className:"p-2 flex justify-between border-b",children:["Ruby Block Editor",(0,o.jsxs)("div",{className:"flex gap-4",children:[(0,o.jsx)("button",{className:"rounded-lg bg-blue-800 px-4",onClick:()=>y(),children:"Gen Ruby"}),(0,o.jsx)("button",{className:"rounded-lg bg-blue-800 px-4",onClick:()=>(()=>{let e=encodeURIComponent(btoa(r||"")),t="".concat(location.origin).concat(location.pathname,"?xmlBase64=").concat(e);navigator.clipboard.writeText(t)})(),children:"Export"})]})]}),(0,o.jsx)("div",{className:"flex-1 z-0",children:(0,o.jsx)("div",{ref:t,className:"w-full h-full"})}),c&&(0,o.jsxs)("div",{className:"fixed inset-0 z-50 bg-white flex flex-col",children:[(0,o.jsxs)("div",{className:"p-2 flex items-center justify-between border-b bg-black",style:{paddingBottom:"calc(env(safe-area-inset-bottom)/4)"},children:[(0,o.jsx)("span",{children:"Ruby コード"}),(0,o.jsxs)("div",{className:"space-x-2",children:[(0,o.jsx)("button",{onClick:x,children:"コピー"}),(0,o.jsx)("button",{onClick:()=>d(!1),children:"閉じる"})]})]}),(0,o.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,o.jsx)(h,{value:_,className:"h-full bg-gray-100 text-gray-800",extensions:[p.Lz.editable.of(!1),p.Lz.lineWrapping],basicSetup:{highlightActiveLine:!1,highlightActiveLineGutter:!1,foldGutter:!0,lineNumbers:!0},readOnly:!0,theme:void 0})})]})]})}}},e=>{e.O(0,[79,263,370,441,964,358],()=>e(e.s=811)),_N_E=e.O()}]);